# Стандартные правила валидации

В классе [Valid] разработчиками созданы типовые правила для часто используемых проверок, например на корректность адреса
 email или длину строки. Все правила возвращают **TRUE**/**FALSE**.

## alpha

Это правило разрешает использовать только буквы.

Параметр | Описание                                  | Формат   | Значение по умолчанию
-------- | ----------------------------------------- | -------- | -----------------------
 `str`   | Значение для проверки                     | string   | -
 `utf8`  | Включение UTF-режима                      | boolean  | FALSE

По умолчанию режим UTF выключен, в итоге из символов будут доступны только латинские буквы. Если необходимо сделать проверку
 не только для латинницы (например, поле `username` может содержать кириллицу), просто установите UTF-режим:

     $valid->rule('username', 'alpha', array(':value', TRUE));

## alpha_dash

Это правило разрешает использовать только буквы, цифры, а также знаки дефис и подчеркивание.

Параметр | Описание                                  | Формат   | Значение по умолчанию
-------- | ----------------------------------------- | -------- | -----------------------
 `str`   | Значение для проверки                     | string   | -
 `utf8`  | Включение UTF-режима                      | boolean  | FALSE

Режим UTF работает аналогично методу [Valid::alpha_dash]:

     $valid->rule('username', 'alpha_dash', array(':value', TRUE));

## alpha_numeric

Это правило разрешает использовать только буквы и цифры.

Параметр | Описание                                  | Формат   | Значение по умолчанию
-------- | ----------------------------------------- | -------- | -----------------------
 `str`   | Значение для проверки                     | string   | -
 `utf8`  | Включение UTF-режима                      | boolean  | FALSE

Режим UTF работает аналогично методу [Valid::alpha_numeric]:

     $valid->rule('username', 'alpha_numeric', array(':value', TRUE));

## color

Правило проверяет корректность формата цвета в 16-ричном формате. Допускаются варианты типа '#aabbcc', 'aabbcc', '#abc' и 'abc'.

Параметр | Описание                                  | Формат   | Значение по умолчанию
-------- | ----------------------------------------- | -------- | -----------------------
 `str`   | Значение для проверки                     | string   | -

 Пример:

    $valid->rule('color', 'color');

## credit_card

Правило проверяет правильность введенного номера кредитной карты.

Параметр  | Описание                                  | Формат   | Значение по умолчанию
--------- | ----------------------------------------- | -------- | -----------------------
 `number` | Значение для проверки                     | string   | -
 `type`   | Тип карты (или типы карт)                 | mixed    | NULL

Типы карт перечислены в конфигурационном файле `SYSPATH/config/credit_card.php`. Чтобы номер карты прошел проверку, должны
 совпасть длина номера (в конфиге перечислены допустимые значения) и префикс (если указан), дополнительно возможна быстрая
 проверка по [алгоритму Луна](http://ru.wikipedia.org/wiki/Алгоритм_Луна). Пример использования:

    // разрешаем прием данных только для карт Visa/MasterCard/Maestro
    $valid->rule('card', 'credit_card', array(':value', array('visa', 'mastercard', 'maestro')));

## date

Правило определяет, является ли введенное значение корректной датой/временем. Точнее, может ли оно быть преобразовано в него.

Параметр | Описание                                  | Формат   | Значение по умолчанию
-------- | ----------------------------------------- | -------- | -----------------------
 `str`   | Значение для проверки                     | string   | -

Пример:

    $valid->rule('birthdate', 'date');

## decimal

Проверка, является ли введенная строка числом с плавающей запятой. Доступны некоторые ограничения на формат числа.

Параметр  | Описание                                  | Формат   | Значение по умолчанию
--------- | ----------------------------------------- | -------- | -----------------------
 `str`    | Значение для проверки                     | string   | -
 `places` | Количество цифр в дробной части           | int      | 2
 `digits` | Количество цифр в целой части             | int      | NULL

[!!] Параметры `$places` и `$digits`, если указаны, обозначают **точное** количество цифр в числе.

Допускается наличие знака ("+" или "-") перед числом. Разделитель целой и дробной части должен соответствовать настройкам
 локали (см функцию [localeconv()](http://php.net/manual/ru/function.localeconv.php)).

 Примеры:

    $valid->rule('price', 'decimal', array(':value', '1'));  // число должно содержать только один знак после запятой
    $valid->rule('price', 'decimal', array(':value', 2, 3)); // только в формате xxx.xx

[!!] Правило не самое логичное, т.к. выставляет довольно жесткие требования. В большинстве случаев достаточно использовать
 правило [Valid::numeric]. Кроме того, достаточно проблематично составить такое сообщение об ошибке, которое одинаково
 четко работало как при передаче двух аргументов, так и передаче всех трех. Например, сейчас если правило не сработает
 из-за аргумента `$digits`, в тексте ошибки все равно останется только информация о размере дробной части.

## digit

Проверяет, состоит ли строка только из цифр. Т.е. это проверка на тип integer (целые числа).

 Параметр | Описание                                  | Формат   | Значение по умолчанию
--------- | ----------------------------------------- | -------- | -----------------------
 `str`    | Значение для проверки                     | string   | -
 `utf8`   | Включение UTF-режима                      | boolean  | FALSE

Пример:

    $valid->rule('count', 'digit');

## email

Очевидно, что правило позволяет проверить строку в качестве адреса email.

 Параметр | Описание                                  | Формат   | Значение по умолчанию
--------- | ----------------------------------------- | -------- | -----------------------
 `email`    | Значение для проверки                   | string   | -
 `strict` | Флаг соответствия RFC822                  | boolean  | FALSE

Аргумент `$strict` позволяет выбрать шаблон для проверки email. В режиме соответствия RFC822 (`$strict` == **TRUE**) будет
 использован менее строгий шаблон, который полностью соответствует требованиям RFC. В режиме несоответствия (по умолчанию)
 применяется более сложный шаблон. В частности, он отсекает заведомо нереальные адреса типа `hello@world` (домен первого уровня),
 которые допустимы в RFC.

Пример:

    $valid->rule('email', 'email');

## email_domain

Проверяет реальное существование [MX-сервера](http://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%BF%D0%B8%D1%81%D1%8C_MX) из адреса электронной почты.
 При этом можно передавать как полный адрес email ("test@example.com"), так и имя хоста ("example.com").

 Параметр | Описание                                  | Формат   | Значение по умолчанию
--------- | ----------------------------------------- | -------- | -----------------------
 `email`  | Значение для проверки                     | string   | -

Пример:

    $valid->rule('email', 'email_domain');

## equals

Сравнивает между собой два поля. Причем с учетом типов (т.е. с использованием оператора === ).

 Параметр   | Описание                                  | Формат   | Значение по умолчанию
----------- | ----------------------------------------- | -------- | -----------------------
 `value`    | Значение для проверки                     | mixed    | -
 `required` | Эталонное значение                        | mixed    | -

Так как данное правило требует передачи конкретных значений для сверки, то область его применения достаточно ограничена.
 Часто ли требуется, чтобы поле было обязательно равно какому-то **одному** значению? Можно добиться некоторого динамизма,
 если в качестве этого значения передавать вычисляемую величину, например текущий год или ID пользователя.

 Пример:

    $valid->rule('year', 'equals', array(':value', date('Y')));

[!!] Данное правило вернет ошибку, если проверяемое значение будет иметь тип, отличный от `string` (например `integer`).

## exact_length

Еще одно не самое распространенное правило. Оно разрешает только строго определенный размер (размеры) строки.

 Параметр   | Описание                                  | Формат   | Значение по умолчанию
----------- | ----------------------------------------- | -------- | -----------------------
 `value`    | Значение для проверки                     | string   | -
 `length`   | Разрешенная длина строки                  | mixed    | -

Значение `length` может быть как числом, так и массивом. В последнем случае правило вернет **TRUE**, если длина
 переданного значения присутствует в этом массиве.

[!!] Передача длины строки типом 'string' не сработает.

Примеры:

    // разрешает только строки длиной в 5 символов
    $valid->rule('string', 'exact_length', array(':value', 5));
    // будет всегда выдавать ошибку, т.к. длина указана в виде строки
    $valid->rule('string', 'exact_length', array(':value', '5'));
    // разрешает строки длиной от 5 до 7 символов
    $valid->rule('string', 'exact_length', array(':value', array(5, 6, 7)));
    // при длине в 5 символов все равно выдаст ошибку
    $valid->rule('string', 'exact_length', array(':value', array('5', 6, 7)));

## ip

Проверка на валидность IP-адреса.

 Параметр        | Описание                                  | Формат   | Значение по умолчанию
---------------- | ----------------------------------------- | -------- | -----------------------
 `ip`            | IP адрес для проверки                     | string   | -
 `allow_private` | Разрешить использование приватных адресов | boolean  | FALSE

Правило проверяет только IPv4 адреса. Изначально отсекаются зарезервированные адреса (адреса широковещательной рассылки,
 localhost-адреса и т.д.), установленный в **FALSE** флаг `allow_private` дополнительно к ним запрещает адреса приватных
 сетей (192.168.0.0/16, 172.16.0.0/12 или 10.0.0.0/8), т.е. не интернет-адреса.

Пример:

    $valid->rule('ip', 'ip');

## luhn

Проверяет введенный номер на соответствие [алгоритму Луна](http://ru.wikipedia.org/wiki/Алгоритм_Луна). В принципе, он уже
 используется в правиле [Valid::credit_card] и самостоятельно обычно не применяется.

 Параметр        | Описание                                  | Формат   | Значение по умолчанию
---------------- | ----------------------------------------- | -------- | -----------------------
 `number`        | Номер для проверки                        | string   | -

## matches

Метод сравнивает между собой два поля из массива данных.

 Параметр   | Описание                                  | Формат          | Значение по умолчанию
----------- | ----------------------------------------- | --------------- | -----------------------
 `array`    | Массив с данными                          | array|object    | -
 `field`    | Имя проверяемого поля                     | mixed           | -
 `match`    | Имя эталонного поля                       | mixed           | -

Наиболее распространенные случаи использования - проверка дважды введенных значений (пароли, адреса электронной почты и т.д.).
 Параметр `array` может быть как массивом, так и объектом `Validation` (или другим объектом с интерфейсом `ArrayObject`).
 Правило сравнивает значения `$array[$field]` и `$array[$match]` с учетом типов данных.

Примеры:

    // проверка подтверждения пароля на соответствие паролю, используем объект Validation
    $valid->rule('password_confirm', 'matches', array(':validation', ':field', 'password'));
    // то же самое, но используем обычный массив
    $valid->rule('password_confirm', 'matches', array(':data', ':field', 'password'));

## max_length

Правило, ограничивающее максимальный размер строки.

 Параметр   | Описание                                  | Формат   | Значение по умолчанию
----------- | ----------------------------------------- | -------- | -----------------------
 `value`    | Значение для проверки                     | string   | -
 `length`   | Максимальная длина строки                 | integer  | -

Пример:

    $valid->rule('username', 'max_length', array(':value', 20));

## min_length

Правило, ограничивающее минимальный размер строки.

 Параметр   | Описание                                  | Формат   | Значение по умолчанию
----------- | ----------------------------------------- | -------- | -----------------------
 `value`    | Значение для проверки                     | string   | -
 `length`   | Минимальная длина строки                  | integer  | -

Пример:

    $valid->rule('password', 'min_length', array(':value', 4));

## not_empty

Проверка на наличие значения.

 Параметр   | Описание                                  | Формат   | Значение по умолчанию
----------- | ----------------------------------------- | -------- | -----------------------
 `value`    | Значение для проверки                     | mixed    | -

Пустыми считаются значения **NULL**, **FALSE** и '' (пустая строка), а также пустой массив (актуально для проверяемых массивов и
 объектов `ArrayObject`). Правило часто используется, в первую очередь для указания полей, обязательных для заполнения.
 Соответственно даже если в массиве данных объекта `Validation` такого поля нет, ошибка для него сгенерируется.

Пример:

    $valid->rule('username', 'not_empty');

## numeric

Проверка чисел с плавающей запятой. Более удобный вариант, чем [Valid::decimal], т.к. не требует явно указывать формат
 целой и дробной частей.

 Параметр   | Описание                            | Формат         | Значение по умолчанию
----------- | ----------------------------------- | -------------- | -----------------------
 `str`      | Значение для проверки               | string|integer | -

Пример:

    $valid->rule('price', 'numeric');

## phone

Проверка на формат номера телефона.

 Параметр   | Описание                                  | Формат   | Значение по умолчанию
----------- | ----------------------------------------- | -------- | -----------------------
 `number`   | Проверяемый телефон                       | string   | -
 `lengths`  | Минимальная длина строки                  | array    | NULL (array(7, 10, 11))

Значение `number` может состоять из любых символов, в любом случае правило проведет чистку, и останутся только цифры.
 Параметр `lengths` должен содержать массив допустимых длин телефонов. По умолчанию правило допускает номера длиной в
 7, 10 и 11 символов (наиболее распространенные международные и внутренние форматы номеров).

[!!] Никаких других проверок, кроме длины номера, в правиле не происходит. По сути, правило `phone` является частным
 случаем правила `exact_length`.

Пример:

    $valid->rule('phone', 'phone', array(':value', array(6, 7, 10, 11)));

## range

Правило ограничивает проверяемое число на принадлежность к указанному допустимому диапазону значений.

 Параметр   | Описание                                  | Формат   | Значение по умолчанию
----------- | ----------------------------------------- | -------- | -----------------------
 `number`   | Проверяемое число                         | float    | -
 `min`      | Минимальное значение диапазона            | float    | -
 `max`      | Максимальное значение диапазона           | float    | -

Параметр `number` должен быть в интервале между `min` и `max` (включительно).

Пример:

    $valid->rule('rate', 'range', array(':value', 1, 5));

## regex

Проверка на соответствие регулярному выражению.

 Параметр     | Описание                                  | Формат   | Значение по умолчанию
------------- | ----------------------------------------- | -------- | -----------------------
 `value`      | Проверяемая строка                        | string   | -
 `expression` | Шаблон регулярного выражения              | string   | -

Для проверки вызывается PHP-функция [preg_match](http://php.net/manual/ru/function.preg-match.php).

Пример:

    // проверка введенной даты в формате DD-MM-YYYY
    $valid->rule('date', 'regex', array(':value', '/^(0[1-9]|[12][0-9]|3[01])-(0[1-9]|1[012])-(12|20)\d{2}$/'));

## url

Проверяет введенный URL на корректность согласно [RFC1738](http://www.apps.ietf.org/rfc/rfc1738.html#sec-5).

 Параметр     | Описание                                  | Формат   | Значение по умолчанию
------------- | ----------------------------------------- | -------- | -----------------------
 `url`        | Проверяемый адрес                         | string   | -

Адрес может содержать такие сегменты, как `username`, `password`, `port` и т.д.

Пример:

    $valid->rule('homepage', 'url');

