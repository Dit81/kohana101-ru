# Драйвер ORM

Драйвер **ORM** поставляется вместе с модулем [ORM], и помимо самого драйвера (класс [Auth_ORM]) содержит [модели](intro/mvc/model)
 для объектов пользователя, роли, токена и тд. Драйвер позволяет хранить данные в БД, и по сравнению с [файловым драйвером](auth/file/basic)
 предоставляет бОльшие возможности, в частности работу с ролями и "[запоминание](auth/orm/autologin)" пользователя.

## Вход и выход {#inout}

    // вход
    if (Auth::instance()->login($username, $plain_password, $remember)) { ... }
    // выход
    Auth::instance()->logout();

## После логина {#after-login}

При успешном логине выполняется метод `complete_login()`. Помимо основной рутины (запись пользователя в сессию) он также
 вызывает метод `complete_login()` модели `Model_User`. В нем обновляются счетчик аутентификаций и метка последнего входа.
 Если необходимо, можно добавить собственные "триггеры" входа на сайт, например логировать данные пользователя в БД или файл.

## Проверки {#checks}

Типичная ситуация - необходимо проверить наличие залогиненного пользователя, а иногда и что-то посложнее:

    // проверка на залогиненность
    if (Auth::instance()->logged_in() { ... }
    // по сути то же самое, но дополнительно получаем модель пользователя
    if ($user = Auth::instance()->get_user()) { ... }
    // проверка на логин + наличие конкретной роли
    if (Auth::instance()->logged_in('admin')) { ... }
    // можно роль передать и в виде готовой модели
    if (Auth::instance()->logged_in($role_object)) { ... }
    // если передать массив ролей, проверяется наличие КАЖДОЙ роли у пользователя
    if (Auth::instance()->logged_in(array('admin', 'moderator')) { ... }


## Принудительный логин {#force_login}

Иногда требуется имитировать успешную аутентификацию, например когда ТехПоддержка не может иначе воспроизвести
 поведение системы относительно конкретного пользователя. Для этого есть метод `force_login`:

    // входим под логином 'ivan ivanov' без пароля
    Auth::instance()->force_login('ivan ivanov', TRUE);

[!!] Обратите внимание на второй параметр метода. Это булевский флаг, позволяющий оставить в сессии признак "форсированного"
 входа. По умолчанию он FALSE, если указать TRUE, то в сессии появится переменная `auth_forced`. После выхода она удаляется.
 Используйте этот флаг, чтобы не позволять совершать лишние операции (проверяйте этот флаг, переспрашивайте пароль и тд).

## Прочее {#others}

Получение хеша пароля пользователя:

    // по логину
    $hash = Auth::instance()->password('ivan ivanov');
    // по объекту
    $hash = Auth::instance()->password($user);
    // хотя того же проще было добиться так:
    $hash = $user->password;

