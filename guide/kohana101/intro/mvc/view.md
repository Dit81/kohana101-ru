# Представление

Представления в **Kohana** являются обычными PHP-скриптами. Обычно они содержат HTML-разметку с PHP-вставками для вывода
 переменных, переданных в представление контроллером. Теоретически в представление можно добавить любой код, но, согласно
 принципам MVC, представление не должно содержать бизнес-логику, только логику отображения. Таким образом, допустимо проходиться
 циклом по массиву данных, но не стоит обращаться к методам модели для получения этих данных.

Например, нам надо вывести краткий список статей. Не стоит выполнять загрузку модели `articles` внутри представления. Этим
 должен заниматься контроллер. А вот выполнять какие-то простые проверки можно, ведь формат вывода может зависеть от используемого
 представления, и контроллер о нем знать не может.

    // переменная $articles была передана в представление контроллером !!
    <?php if (! empty($articles) : ?>
    <ul>
        <?php foreach($articles as $article): ?>
        <li>
            <p><?php echo $article->title ?></p>
            <p><?php echo $article->author->username ?></p>
        </li>
        <?php endforeach ?>
    </ul>
    <?php else: ?>
    <p>Статей нет</p>
    <?php endif ?>

## Файлы представлений {#files}

Файлы располагаются в директориях `views`. Можно использовать поддиректории.

 Имя представления     | Путь к файлу
---------------------- | -----------------------------------------
 `index`               | `views/index.php`
 `foo/bar`             | `views/foo/bar.php`
 `foo_bar`             | `views/foo_bar.php`
 `index/content`       | `views/index/content.php`
 `index/sidebar/news`  | `views/index/sidebar/news.php`

[!!] Обратите внимание, что знаки подчеркивания не означают наличие поддиректории.

## Работа с представлениями {#working}

### Создание {#create}

Представления можно создать через конструктор или фабричный метод:

    // создаем шаблон из файла views/index.php
    $view = new View('index');
    $view = View::factory('index');

### Работа с переменными {#vars}

Для добавления переменных существуют различные способы:

    $view->set('foo', $bar);
    $view->foo = $bar;

Второй способ медленнее, и в итоге все равно вызывает метод `set()`.

Установить можно и сразу несколько переменных:

    $view->set(array('param1' => $param1, 'param2' => $param2));

Кроме того, можно передавать переменные прямо в конструктор, после имени файла:

    $view = View::factory('index', array('foo' => $bar));

Значения переменных получаем прямым обращением к ним:

    $bar = $view->foo;

### Глобальные переменные {#globals}

Можно установить значения сразу для всех используемых представлений. Для этого предусмотрены так называемые глобальные
 переменные.

    $view->set_global('test', $test);
    // точно также можно передать массив переменных
    $view->set_global(array('global1' => $global1, 'global2' => $global2));
    // обращаемся к ним как к обычным переменным шаблона
    $test = $view->test;
    // переменная добавляется ко всем шаблонам
    $test1 = $view1->test;

[!!] Если в представлении есть как локальная, так и глобальная переменные с одним именем, то будет возвращено локальное значение.

### Используемый файл шаблона {#filename}

При создании представления необязательно указывать имя файла. Его можно указать и позже, с помощью метода `set_filename()`:

    $view = View::factory();
    $view->foo = $foo;
    $view->set_filename('index');

Аналогично можно поменять имя шаблона, если оно было ранее указано. При этом все добавленные в объект переменные сохранятся.

### Вывод представления {#rendering}

Чтобы отобразить представление, можно использовать метод `render()` или просто привести объект `View` к типу `string`:

    echo $view->render();
    echo (string)$view;
    // а можно и без явного преобразования
    echo $view;

При выводе представления можно указать имя файла.

    echo $view->render('new_index');

При этом объект `$view` тоже поменяет используемый файл на новый. Т.е. этот вызов эквивалентен

    $view->set_filename('new_index');
    echo view->render();

### Вложенные шаблоны {#subtemplate}

В качестве переменных объекта `View` могут выступать самые различные объекты, в том числе и другие представления:

    $view = View::factory('index');
    $view->sudebar = View::factory('sidebar');
    $view->content = View::factory('content');

В дальнейшем они также будут доступны для использования из контроллера:

    // устанавливаем переменную во вложенном представлении
    $view->content->article = $article;

Другой способ - создание представления в теле другого представления:

    <div id="content">
        <?php echo View::factory('content') ?>
    </div>
    <div id="sidebar">
        <?php echo View::factory('sidebar') ?>
    </div>

Локальные переменные, доступные в родительском представлении, во вложенное сами собой не передадутся. Их необходимо добавлять
 вручную:

    // в данном шаблоне имеются переменные $articles и $author
    <div id="content">
        <?php echo View::factory('content')->set('articles', $articles) ?>
    </div>
    <div id="sidebar">
        <?php echo View::factory('sidebar')->set('author', $author) ?>
    </div>

[!!] Глобальные переменные, само собой, доступны в каждом представлении.