# Внешний запрос

В **Kohana 3.2** под внешними запросами (external requests) подразумеваются все запросы, использующие абсолютную адресацию.
 Например, `Request::factory('welcome')` - [внутренний запрос](basic/request/internal), а `Request::factory('http://localhost/welcome/')`
 уже будет обрабатываться как внутренний. **Kohana** проверяет наличие протокола ('http://', 'ftp://' и т.д.) в переданном адресе.

## Драйверы {#drivers}

За выполнение внешнего запроса отвечает драйвер, отнаследованный от `Request_Client_External` (а тот, в свою очередь, от
 `Request_Client`). Каждый драйвер использует свой транспорт для обмена данными с внешним ресурсом. В **Kohana** разработаны
 три вида драйверов:

 * `Request_Client_Curl`, использует расширение `Curl`. Это транспорт по умолчанию.
 * `Request_Client_Http`, для его работы необходимо наличие `PECL_HTTP`.
 * `Request_Client_Stream`. Данный транспорт не требует никаких расширений, но он самый медленный.

При создании запроса нельзя явно указать тип используемого драйвера. Всегда будет использоваться драйвер по умолчанию. Однако
 можно изменить дефолтный тип драйвера, поменяв значение свойства `Request_Client_External::$client` на одно из вышеперечисленных
 значений.

## Написание собственного драйвера {#custom}

Если потребовалось использовать нестандартный способ обращения к внешним сервисам, можно реализовать собственную версию
 драйвера для внешних запросов. Требований два:

 * Драйвер должен быть унаследован от класса `Kohana_Request_Client_External`.
 * Механизм запроса данных должен располагаться в public-методе `_send_message(Request $request)` и возвращать объект `Response`.

В дальнейшем этот новый драйвер можно использовать даже в качестве дефолтного (используя свойство `Request_Client_External::$client`).
 Либо можно воспользоваться [заменой драйвера](basic/request#drivers) "на лету", с помощью метода `client()`.

## Подготовка запроса {#options}

Как мы знаем, в классе [Request] доступны [стандартные методы](basic/request#setparams) для передачи данных запроса.
 Для выполнения внешнего запроса создается объект [Request_Client_External], и у него есть специальный метод
 `options()`, который позволяет передать дополнительные опции для используемого [драйвера запроса](#drivers).
 Работает он точно так же, как `query()` или `headers()` - можно передать массив параметров в виде ключ-значение, а можно
 только одну пару (первый аргумент - ключ, второй - значение):

  // актуально для драйвера CURL
	$request->client()->options(CURLOPT_RETURNTRANSFER, TRUE);

[!!] После внесения изменений в драйвер, обратно его сохранять (методом `client()`) не надо.
